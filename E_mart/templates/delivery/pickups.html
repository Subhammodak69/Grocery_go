{% extends 'delivery/base.html'%}
{% load static %}
{% block title %} Pickups | Delivery Site {% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/enduser/cart.css' %}">
<link rel="stylesheet" href="{% static 'css/enduser/order.css' %}">
{% endblock %}
{% block content %}
<div class="container-9 py-4 px-4" style="min-height: 100vh; background:white;">
  <div class="cart-header mb-4">
    <h2 class="cart-title"><i class="fas fa-shopping-bag me-2"></i>Your Pickup Orders</h2>
    <p class="cart-subtitle text-gray">
      {% if pickups %}{{ pickups|length }} item{{ pickups|length|pluralize }} in your Exchanges and Returns
      {% else %}You have no Exchanges and Returns yet{% endif %}
    </p>
  </div>

  {% if pickups %}
    <div class="orders-list">
    {% for pickup_data in pickups %}
      {% with pickup_data.pickup as pickup %}
      {% with pickup_data.items as items %}
      <div class="order-card-horiz" onclick="window.location.href = '/delivery-worker/pickup/order-details/{{ pickup_data.exchange_or_return.order.id }}/'">
        <div class="order-card-left">
          <!-- PHOTO FIELD -->
          <div class="order-photo-block">
            {% with items|length as item_count %}
            
            {% if item_count == 1 %}
              {% with items.0 as item %}
              <img
                src="{% if item.order_item.product.image %}{% static item.order_item.product.image %}{% else %}{% static 'no_image.png' %}{% endif %}"
                class="order-img-single"
                alt="{{ item.name }}">
              {% endwith %}

            {% elif item_count == 2 %}
              {% for item in items %}
                <img
                  src="{% if item.order_item.product.image %}{% static item.order_item.product.image %}{% else %}{% static 'no_image.png' %}{% endif %}"
                  class="order-img-grid order-img-grid-2 order-img-pos-{{ forloop.counter }}"
                  alt="{{ item.name }}">
              {% endfor %}

            {% elif item_count == 3 %}
              {% for item in items|slice:":2" %}
                <img
                  src="{% if item.order_item.product.image %}{% static item.order_item.product.image %}{% else %}{% static 'no_image.png' %}{% endif %}"
                  class="order-img-grid order-img-grid-2 order-img-pos-{{ forloop.counter }}"
                  alt="{{ item.name }}">
              {% endfor %}
              {% with items.2 as item %}
              <img
                src="{% if item.order_item.product.image %}{% static item.order_item.product.image %}{% else %}{% static 'no_image.png' %}{% endif %}"
                class="order-img-grid order-img-grid-3 order-img-pos-3"
                alt="{{ item.name }}">
              {% endwith %}

            {% elif item_count == 4 %}
              {% for item in items|slice:":4" %}
                <img
                  src="{% if item.order_item.product.image %}{% static item.order_item.product.image %}{% else %}{% static 'no_image.png' %}{% endif %}"
                  class="order-img-grid order-img-grid-4 order-img-pos-{{ forloop.counter }}"
                  alt="{{ item.name }}">
              {% endfor %}

            {% elif item_count > 4 %}
              {% for item in items|slice:":3" %}
                <img
                  src="{% if item.order_item.product.image %}{% static item.order_item.product.image %}{% else %}{% static 'no_image.png' %}{% endif %}"
                  class="order-img-grid order-img-grid-4 order-img-pos-{{ forloop.counter }}"
                  alt="{{ item.name }}">
              {% endfor %}
              {% with items.3 as item %}
              <img
                src="{% if item.order_item.product.image %}{% static item.order_item.product.image %}{% else %}{% static 'no_image.png' %}{% endif %}"
                class="order-img-grid order-img-grid-4 order-img-pos-4"
                alt="{{ item.name }}">
              {% endwith %}
              <div class="order-img-more-overlay">
                +{{ item_count|add:'-4' }}
              </div>
            {% endif %}
            
            {% endwith %}
          </div>

          <!-- INFO FIELD -->
          <div class="order-main-info">
            <div class="order-title">
              {% for item in items %}
                {{ item.order_item.product.name }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </div>
            <div class="order-address">
              <strong style="white-space: nowrap;">Pickup Address:</strong>
              <p style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                {{ pickup.address }}
              </p>
            </div>
          </div>
        </div>

        <div class="order-card-price">
          â‚¹{{ pickup_data.total|floatformat:2 }}
        </div>
        
        <div class="order-card-status">
          <span class="status-dot"></span>
          {{ pickup_data.status }} on {{ pickup_data.request_date|date:"M d, Y" }}
        </div>
      </div>
      {% endwith %}
      {% endwith %}
      {% endfor %}
    </div>
  {% else %}
    <div class="empty-state text-center py-8">
      <i class="fas fa-truck-loading fa-4x text-muted mb-4"></i>
      <h4 class="text-muted mb-2">No Pickups assigned yet</h4>
      <p class="text-muted mb-4">You'll see your assigned pickup orders here.</p>
      <a href="{% url 'delivery_worker_home' %}" class="btn btn-primary">
        <i class="fas fa-home me-2"></i>Go to Dashboard
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
