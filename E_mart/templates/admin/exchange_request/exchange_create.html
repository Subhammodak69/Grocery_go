{% extends 'admin/home.html' %}
{% load static %}
{% block title %}Create Exchange Request{% endblock %}
{% block content %}
<script src="{% static 'js/admin/exchange_request/exchange_create.js' %}"></script>
<div class="card shadow-sm m-auto mt-4 p-4 rounded" style="max-width: 600px;">
    <h2 class="mb-4 text-center fw-bold" style="color: #007bff;">Create Exchange Request</h2>
    <form class="px-3" id="adminExchangeForm" onsubmit="return false;" novalidate>
        <div class="mb-3">
            <label for="order" class="form-label fw-semibold">Order*</label>
            <select id="order" name="order" class="form-select" required>
                <option value=''>Select Order</option>
                {% for order in orders %}
                <option value="{{ order.id }}">{{ order.id }} - {{ order.user.username }} (â‚¹{{ order.total_price }})</option>
                {% endfor %}
            </select>
        </div>

        
        <div class="mb-3">
            <label for="user" class="form-label fw-semibold">User*</label>
            <select id="user" name="user" class="form-select" required>
                <option value=''>Select User</option>
                {% for user in users %}
                <option value="{{ user.id }}">{{ user.username }} ({{ user.email }})</option>
                {% endfor %}
            </select>
        </div>


        <div class="mb-3">
            <label for="reason" class="form-label fw-semibold">Reason*</label>
            <textarea id="reason" name="reason" class="form-control" placeholder="Enter reason for exchange/return" required style="border-radius: 6px;"></textarea>
        </div>

        <div class="mb-3">
            <label for="status" class="form-label fw-semibold">Status*</label>
            <select id="status" name="status" class="form-select" required>
                <option value=''>Select Status</option>
                <option value="1">Pending</option>
                <option value="2">Processing</option>
                <option value="3">Approved</option>
                <option value="4">Rejected</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="purpose" class="form-label fw-semibold">Purpose*</label>
            <select id="purpose" name="purpose" class="form-select" required>
                <option value=''>Select Purpose</option>
                <option value="1">Exchange</option>
                <option value="2">Return</option>
            </select>
        </div>

        <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="is_active" name="is_active" checked>
            <label class="form-check-label fw-semibold" for="is_active">Active</label>
        </div>

        <button type="submit" onclick="exchange_create()" class="btn btn-primary fw-bold mt-3 w-100" style="padding: 12px; font-size: 18px; border-radius: 8px;">
            Create Exchange Request
        </button>
    </form>
    <div id="message" class="text-center mt-4 fw-semibold m-auto"></div>
</div>

<script>
document.getElementById('order').addEventListener('change', function() {
    const orderId = this.value;
    if (orderId) {
        fetch(`/admin/exchange/get-order-items/${orderId}/`)
            .then(response => response.json())
            .then(items => {
                const orderItemSelect = document.getElementById('order_item');
                orderItemSelect.innerHTML = '<option value="">Select Order Item</option>';
                items.forEach(item => {
                    orderItemSelect.innerHTML += `<option value="${item.id}">${item.product.name} (Qty: ${item.quantity})</option>`;
                });
            });
    }
});
</script>

<style>
    #message.error { color: #dc3545; margin: 20px auto; }
    #message.success { color: #28a745; margin: 20px auto; }
</style>
{% endblock %}
