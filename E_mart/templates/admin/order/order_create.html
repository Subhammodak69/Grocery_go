{% extends 'admin/home.html' %}
{% load static %}
{% block title %}Create Admin Order{% endblock %}
{% block content %}
<script src="{% static 'js/admin/order/order_create.js' %}"></script>
<div class="card shadow-sm m-auto mt-4 p-4 rounded" style="max-width: 800px;">
    <h2 class="mb-4 text-center fw-bold" style="color: #007bff;">Create Admin Order</h2>
    <form class="px-3" id="adminOrderForm" onsubmit="return false;" novalidate>
        <div class="mb-3">
            <label for="user" class="form-label fw-semibold">User*</label>
            <select id="user" name="user" class="form-select" required>
                <option value=''>--Select--</option>
                {% for user in users %}
                <option value="{{ user.id }}">{{ user.username }} ({{ user.email }})</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-4">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <label class="form-label fw-semibold">Select Order Items *</label>
                <small class="text-muted">Select products and set quantities</small>
            </div>
            
            <div class="border p-3 rounded" style="max-height: 400px; overflow-y: auto;">
                {% for item in products %}
                <div class="row align-items-center mb-3 p-2 border-bottom">
                    <div class="col-2">
                        <img src="{% static item.image %}" alt="{{ item.name }}" class="img-fluid rounded" style="height: 50px; width: 50px; object-fit: cover;">
                    </div>
                    <div class="col-4">
                        <strong>{{ item.name }}</strong>
                        <span class="original-price">₹{{ item.original_price }} </span>
                        <p class="discount-label mb-0">{{ item.discount|floatformat:2 }}%</p>
                        <span class="discounted-price">₹{{ item.price }}/{{ item.size }}</span>              
                    </div>
                    <div class="col-3">
                        <div class="input-group input-group-sm" style="width: 100px;">
                            <span class="input-group-text">Qty</span>
                            <input type="number" 
                                   class="form-control product-quantity" 
                                   min="0" 
                                   max="99" 
                                   value="0"
                                   data-product-id="{{ item.id }}"
                                   data-product-price="{{ item.original_price }}"
                                   data-product-sale-price="{{ item.price }}"
                                   style="border-radius: 6px;">
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="form-check">
                            <input class="form-check-input product-checkbox" 
                                   type="checkbox" 
                                   id="product_{{ item.id }}"
                                   data-product-id="{{ item.id }}"
                                   {% if forloop.counter0 == 0 %}checked{% endif %}>
                            <label class="form-check-label small" for="product_{{ item.id }}">
                                Include
                            </label>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-4 text-muted">
                    <i class="fas fa-box-open fa-2x mb-2 d-block"></i>
                    No products available
                </div>
                {% endfor %}
            </div>
        </div>


        <div class="mb-3">
            <label for="status" class="form-label fw-semibold">Status*</label>
            <select id="status" name="status" class="form-select" required>
                <option value="">--Select--</option>
                {% for status in order_statuses %}
                <option value="{{status.value}}">{{status.name}}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="total_price" class="form-label fw-semibold">Total Price*</label>
            <input type="number" step="0.01" id="total_price" name="total_price" class="form-control" placeholder="Auto count" required style="border-radius: 6px;" readonly>
        </div>

        <div class="mb-3">
            <label for="discount" class="form-label fw-semibold">Discount</label>
            <input type="number" step="0.01" id="discount" name="discount" class="form-control" placeholder="Auto count" required style="border-radius: 6px;" readonly>
        </div>

        <div class="mb-3">
            <label for="delivery_fee" class="form-label fw-semibold">Delivery Fee*</label>
            <input type="number" step="0.01" id="delivery_fee" name="delivery_fee" class="form-control" placeholder="Auto count" required style="border-radius: 6px;" readonly>
        </div>

        <div class="mb-3">
            <label for="listing_price" class="form-label fw-semibold">Listing Price*</label>
            <input type="number" step="0.01" id="listing_price" name="listing_price" class="form-control" placeholder="Auto count" required style="border-radius: 6px;" readonly>
        </div>

        <div class="mb-3">
            <label for="delivery_address" class="form-label fw-semibold">Delivery Address</label>
            <textarea id="delivery_address" name="delivery_address" class="form-control" placeholder="Enter delivery address" style="border-radius: 6px;"></textarea>
        </div>

        <div class="form-check form-switch mb-4">
            <input class="form-check-input" type="checkbox" id="is_active" name="is_active" checked>
            <label class="form-check-label fw-semibold" for="is_active">Active</label>
        </div>

        <button type="submit" onclick="order_create()" class="btn btn-primary fw-bold mt-3 w-100" style="padding: 12px; font-size: 18px; border-radius: 8px;">
            Create Order
        </button>
    </form>
    <div id="message" class="text-center mt-4 fw-semibold m-auto"></div>
</div>

<style>
    #message.error {
        margin: 20px auto;
        color: #dc3545;
    }
    #message.success {
        margin: 20px auto;
        color: #28a745;
    }
    
    .product-checkbox:checked + .form-check-label {
        font-weight: 600;
        color: #007bff;
    }
    
    .border-bottom {
        border-bottom: 1px solid #dee2e6 !important;
    }
    
    .input-group-text {
        background-color: #f8f9fa;
        border-radius: 6px 0 0 6px;
    }
    
    .product-quantity {
        border-left: none;
        border-radius: 0 6px 6px 0;
    }
</style>
{% endblock %}
