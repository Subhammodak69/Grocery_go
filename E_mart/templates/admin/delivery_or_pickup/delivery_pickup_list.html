{% extends "admin/home.html" %}
{% load static %}
{% block title %}Delivery/Pickup List{% endblock %}
{% block content %}
<script src="{% static 'js/admin/delivery_or_pickup/delivery_pickup_list.js' %}"></script>
<div class="overflow-auto p-4 rounded h-100">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h4>Delivery & Pickup List</h4>
        <button class="btn btn-success" onclick="create_delivery()">+Create Delivery/Pickup</button>
    </div>
    <table class="table table-striped table-bordered w-100">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Order ID</th>
                <th>Address</th>
                <th>Delivery Person</th>
                <th>Status</th>
                <th>Purpose</th>
                <th>Assigned Date</th>
                <th>Delivered Date</th>
                <th>Is Active</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for delivery in deliveries %}
            <tr>
                <td>{{ delivery.id }}</td>
                <td>{{ delivery.order.id }}</td>
                <td title="{{ delivery.address }}">{{ delivery.address|truncatechars:30 }}</td>
                <td>{{ delivery.delivery_person.user.first_name|default:"Not Assigned" }}</td>
                <td>
                    <span class="badge bg-{% if delivery.status == 1 %}info{% elif delivery.status == 2 %}warning{% elif delivery.status == 3 %}success{% elif delivery.status == 4 %}danger{% else %}secondary{% endif %}">
                        {{ delivery.get_status_display }}
                    </span>
                </td>
                <td>{{ delivery.get_purpose_display }}</td>
                <td>{{ delivery.assigned_at|date:"M d, Y H:i" }}</td>
                <td>{{ delivery.delivered_at|date:"M d, Y H:i"|default:"Pending" }}</td>
                <td>
                    <div class="form-check form-switch" onclick="isactive_toggle({{ delivery.id }})">
                        <input class="form-check-input toggle-active" type="checkbox" data-delivery-id="{{ delivery.id }}" {% if delivery.is_active %}checked{% endif %} />
                    </div>
                </td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="update_delivery({{ delivery.id }})">Update</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<style>
    td {
        max-width: 150px;        
        white-space: nowrap;     
        overflow: hidden;       
        text-overflow: ellipsis; 
    }
</style>
{% endblock %}
