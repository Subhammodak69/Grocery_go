{% extends 'admin/home.html' %}
{% load static %}
{% block title %}Update Delivery/Pickup{% endblock %}
{% block content %}
<script src="{% static 'js/admin/delivery_or_pickup/delivery_pickup_update.js' %}"></script>
<div class="card shadow-sm m-auto mt-4 p-4 rounded" style="max-width: 600px;">
    <h2 class="mb-4 text-center fw-bold" style="color: #007bff;">Update Delivery/Pickup</h2>
    <form class="px-3" id="adminDeliveryForm" onsubmit="return false;" novalidate>
        <input id="delivery_id" value="{{ delivery.id }}" hidden>
        
        <div class="mb-3">
            <label for="order" class="form-label fw-semibold">Order*</label>
            <select id="order" name="order" class="form-select" required>
                {% for order in orders %}
                <option value="{{ order.id }}" {% if order.id == delivery.order.id %}selected{% endif %}>
                    {{ order.id }} - {{ order.user.username }} (â‚¹{{ order.total_price }})
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="address" class="form-label fw-semibold">Address*</label>
            <textarea id="address" name="address" class="form-control" style="border-radius: 6px; min-height: 80px;" required>{{ delivery.address }}</textarea>
        </div>

        <div class="mb-3">
            <label for="delivery_person" class="form-label fw-semibold">Delivery Person</label>
            <select id="delivery_person" name="delivery_person" class="form-select">
                <option value=''>Select Delivery Person (Optional)</option>
                {% for person in delivery_persons %}
                <option value="{{ person.id }}" {% if person.id == delivery.delivery_person.id %}selected{% endif %}>
                    {{ person.user.first_name }} {{person.user.last_name}} ({{ person.user.phone|default:"No Phone" }})
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Current Status: {{ delivery.get_status_display }}</label>
            <small class="text-muted">Assigned At: {{ delivery.assigned_at|date:"M d, Y H:i" }}</small>
            {% if delivery.delivered_at %}
            <br><small class="text-muted">Delivered: {{ delivery.delivered_at|date:"M d, Y H:i" }}</small>
            {% endif %}
        </div>

        <div class="mb-3">
            <label for="status" class="form-label fw-semibold">Status*</label>
            <select id="status" name="status" class="form-select" required>
                <option value="1" {% if delivery.status == 1 %}selected{% endif %}>Pending</option>
                <option value="2" {% if delivery.status == 2 %}selected{% endif %}>Assigned</option>
                <option value="3" {% if delivery.status == 3 %}selected{% endif %}>In Transit</option>
                <option value="4" {% if delivery.status == 4 %}selected{% endif %}>Delivered</option>
                <option value="5" {% if delivery.status == 5 %}selected{% endif %}>Cancelled</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="purpose" class="form-label fw-semibold">Purpose*</label>
            <select id="purpose" name="purpose" class="form-select" required>
                <option value="1" {% if delivery.purpose == 1 %}selected{% endif %}>Delivery</option>
                <option value="2" {% if delivery.purpose == 2 %}selected{% endif %}>Pickup</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="delivered_at" class="form-label fw-semibold">Delivered At</label>
            <input type="datetime-local" id="delivered_at" name="delivered_at" 
                   class="form-control" style="border-radius: 6px;"
                   value="{% if delivery.delivered_at %}{{ delivery.delivered_at|date:'Y-m-d\TH:i' }}{% endif %}">
        </div>

        <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if delivery.is_active %}checked{% endif %}>
            <label class="form-check-label fw-semibold" for="is_active">Active</label>
        </div>

        <button type="submit" onclick="delivery_update()" class="btn btn-primary fw-bold mt-3 w-100" style="padding: 12px; font-size: 18px; border-radius: 8px;">
            Update Delivery/Pickup
        </button>
    </form>

    <div id="message" class="text-center mt-4 fw-semibold m-auto"></div>
</div>

<style>
    #message.error { margin: 20px auto; color: #dc3545; }
    #message.success { margin: 20px auto; color: #28a745; }
</style>
{% endblock %}
